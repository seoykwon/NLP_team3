# 계층관계 RAG QA 시스템

## 📋 프로젝트 개요

삼성전자 감사보고서(2014-2024)를 대상으로 한 계층관계를 고려한 RAG(Retrieval-Augmented Generation) QA 시스템입니다. 상하위 계층관계가 있는 과목들(예: 자산 → 유동자산 → 현금및현금성자산)을 함께 답변으로 제공합니다.

## 🏗️ 시스템 아키텍처

### 핵심 구성요소
- **임베딩 모델**: BGE-M3-KO (한국어 최적화)
- **벡터 데이터베이스**: Qdrant
- **LLM**: ChatGPT-4 (답변 생성 및 어투 정리)
- **웹 인터페이스**: Streamlit

### 계층관계 매핑
```python
hierarchy_mapping = {
    "자산": ["유동자산", "비유동자산"],
    "유동자산": [
        "현금및현금성자산", "단기금융상품", "단기매도가능금융자산", 
        "매출채권", "미수금", "선급금", "선급비용", "재고자산", 
        "기타유동자산", "매각예정분류자산"
    ],
    "비유동자산": [
        "기타포괄손익-공정가치금융자산", "당기손익-공정가치금융자산",
        "장기매도가능금융자산", "종속기업, 관계기업및공동기업투자",
        "유형자산", "무형자산", "순확정급여자산", "이연법인세자산",
        "기타비유동자산"
    ],
    # 부채, 자본, 손익, 현금흐름 계층도 포함
}
```

## 🚀 주요 기능

### 1. 계층관계 인식 검색
- 쿼리에서 계층관계 키워드 자동 추출
- 상위/하위 항목들을 함께 검색
- 관련 계층관계 항목들 자동 확장

### 2. 향상된 답변 생성
- 계층관계 정보를 포함한 답변
- 상하위 관계를 명확히 설명
- 청크 참조 및 근거 제시

### 3. 웹 인터페이스
- 실시간 대화형 QA
- 계층관계 정보 별도 표시
- 검색 파라미터 조절 가능

## 📁 파일 구조

```
final_api_hierarchy/
├── scripts/
│   ├── hierarchy_rag_qa_system.py    # 계층관계 RAG 시스템 (메인)
│   ├── rag_qa_system.py              # 기본 RAG 시스템
│   ├── build_qdrant_vector_db.py     # 벡터 DB 구축
│   └── embed_with_bge_m3_ko.py       # 임베딩 생성
├── data/
│   ├── processed/                    # 처리된 감사보고서 데이터
│   └── raw/                         # 원본 HTML 파일들
├── streamlit_rag_chatbot.py         # Streamlit 웹 인터페이스
├── requirements.txt                 # 의존성 패키지
└── README_HIERARCHY_RAG.md         # 이 파일
```

## 🛠️ 설치 및 실행

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. 환경변수 설정
```bash
export OPENAI_API_KEY="your_openai_api_key"
```

### 3. 벡터 데이터베이스 구축
```bash
python scripts/build_qdrant_vector_db.py
```

### 4. 시스템 실행

#### 터미널에서 실행
```bash
python scripts/hierarchy_rag_qa_system.py
```

#### 웹 인터페이스 실행
```bash
streamlit run streamlit_rag_chatbot.py
```

## 💡 사용 예시

### 질문 예시
- "유동자산에 대해 알려주세요" → 하위 항목들도 함께 표시
- "현금및현금성자산은 얼마인가요?" → 상위 계층관계도 함께 설명
- "2024년 비유동자산에 대해 알려주고 각 하위항목의 값도 알려줘"

### 답변 특징
- 계층관계 정보를 별도 섹션으로 표시
- 상하위 관계를 명확히 설명
- 청크 참조 및 근거 제시

## 🔒 RAG 시스템의 핵심 원칙

### LLM의 역할 (허용)
- ✅ 답변 어투 정리 및 구조화
- ✅ 제공된 컨텍스트 정보만을 사용한 답변 생성
- ✅ 계층관계 정보를 포함한 답변 구성
- ✅ 청크 정보 참조 및 근거 제시

### LLM의 제약 (금지)
- ❌ 신규 정보 생성 또는 추측
- ❌ 제공된 컨텍스트 외부의 지식 사용
- ❌ 데이터베이스에 없는 정보 답변

## 📊 성능 특징

### 검색 성능
- 계층관계 키워드 자동 인식
- 관련 항목들 자동 확장 검색
- 유사도 기반 결과 정렬

### 답변 품질
- 계층관계 구조 명확히 설명
- 구체적인 수치와 데이터 포함
- 청크 참조로 투명성 확보

## 🔧 설정 옵션

### 검색 파라미터
- `top_k`: 검색할 청크 수 (기본값: 8)
- `score_threshold`: 유사도 임계값 (기본값: 0.6)

### 모델 설정
- 임베딩 모델: BGE-M3-KO
- LLM: ChatGPT-4
- Temperature: 0.1 (일관된 답변을 위해)

## 📈 향후 개선 방향

1. **계층관계 매핑 확장**: 더 세밀한 계층관계 정의
2. **다국어 지원**: 영어, 중국어 등 추가 언어 지원
3. **시각화 개선**: 계층관계 구조의 시각적 표현
4. **성능 최적화**: 검색 속도 및 정확도 향상

## 📞 문의 및 지원

이 시스템은 삼성전자 감사보고서 데이터를 기반으로 한 계층관계 RAG QA 시스템입니다. 
상하위 계층관계가 있는 과목들을 함께 답변으로 제공하여 더욱 포괄적이고 구조화된 정보를 제공합니다.

---
*생성일: 2024년 9월 24일*
*버전: 1.0.0*
